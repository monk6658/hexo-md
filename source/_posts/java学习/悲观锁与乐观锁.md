---
title: 悲观锁与乐观锁 #文章页面上的显示名称，一般是中文
date: 2020-10-21 14:16:33 #文章生成时间，一般不改，当然也可以任意修改
categories: 并发 #分类
tags: [锁机制,并发] #文章标签，可空，多标签请用格式，注意:后面有个空格
description: 乐观锁对应于生活中乐观的人总是想着事情往好的方向发展，悲观锁对应于生活中悲观的人总是想着事情往坏的方向发展。这两种人各有优缺点，不能不以场景而定说一种人好于另外一种人。
---

## 悲观锁

[TOC]

### 1. 悲观锁定义

在修改数据之前先锁定，再修改的方式被称之为悲观并发控制【Pessimistic Concurrency Control，缩写“PCC”，又名“悲观锁”】。

**共享资源每次只给一个线程使用，其它线程阻塞，用完后再把资源转让给其它线程。**

悲观锁，具有强烈的独占和排他特性。传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁。Java中`synchronized`和`ReentrantLock`等独占锁就是悲观锁思想的实现。

### 2. 种类

1. 共享锁【shared locks】又称为读锁，简称S锁。多个事务对于同一数据可以共享一把锁，都能访问到数据，但是只能读不能修改。
2. 排他锁【exclusive locks】又称为写锁，简称X锁。排他锁就是不能与其他锁并存，

## 乐观锁

### 2. 乐观锁定义

**乐观锁一般会使用版本号机制或CAS算法实现。**乐观锁适用于多读的应用类型，这样可以提高吞吐量**，像数据库提供的类似于**write_condition机制**，其实都是提供的乐观锁。在Java中`java.util.concurrent.atomic`包下面的原子变量类就是使用了乐观锁的一种实现方式**CAS**实现的。**

### 3. 两者比较

|          | 乐观锁                                 | 悲观锁                                                       |
| -------- | -------------------------------------- | ------------------------------------------------------------ |
| 适用场景 | **适用于写比较少的情况下（多读场景）** | **多写的场景下用悲观锁就比较合适**                           |
| 实现     |                                        | 1. 传统的关系型数据库的行锁，表锁等，读锁，写锁等<br />2. [synchronized](https://www.jianshu.com/p/c8f997e7f75c) 关键字 |

